<!DOCTYPE html>
<html lang="zh-cn"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<meta http-equiv="Content-Language" content="zh-CN">
<meta name="author" content="管雷鸣">
<title>客服坐席</title>
<script src="http://res.weiunity.com/msg/msg.js--"></script>
<script src="./msg.js"></script>
<script src="kefu.js"></script>
<link rel="stylesheet" type="text/css" href="./css/style.css" media="screen">
<style>
:root {
    /* 聊天窗口中我发出去的消息的背景色 */
    --user-chat-background-color: #daf4fd;
}
</style>
</head>
<body>


<div id="list" style=" max-width: 40rem; width: 22rem;position: absolute; background: aliceblue;  height: 100%; overflow: scroll;"></div>
<div style="float: left;  max-width: 400px;">
	<div id="chat">
    </div>
</div>


<script type="text/javascript">
var host = 'http://kefu.wfyuntu.com';
var socketUrl = 'ws://119.3.209.5:8081';
//var host = 'http://localhost:8080';
//var socketUrl = 'ws://localhost:8081/';

//kefu.js 接口设置
//kefu.api.getMyUser = 'http://'+host+'/user/init.json';
kefu.api.getMyUser = host+'/inset/chat/login.json';
kefu.api.getChatOtherUser = host+'/user/getUserById.json';
kefu.api.chatLog = host+'/chatLog.json';
kefu.api.uploadImage = host+'/uploadImage.json';
kefu.extend.order.requestApi = 'http://cust.wfyuntu.com/plugin/kefu/getOrderList.json';


kefu.mode='pc';
kefu.ui.list.renderAreaId = 'list';
kefu.ui.chat.renderAreaId = 'chat';

kefu.ui.chat.html = kefu.ui.chat.pc.html;

/* pc chat */
kefu.extend.pc={
	initChat:function(){
		kefu.chat.shuruType = 'jianpan'
		kefu.chat.shuruTypeChange();
		
		kefu.ui.chat.pc.moveInit();	//鼠标移动
		//kefu.ui.chat.pc.sizeChange.moveInit();	//拖动大小
		document.getElementById('close').innerHTML = kefu.ui.images.close.replace(/{color}/g,kefu.extendIconColor);
	}
};

/*不再pc端显示订单输入*/
kefu.extend.order.icon = null;
kefu.extend.order.sendOrder=function(str, obj, str){};
/* 商品相关 */
kefu.extend.goods.sendGoods=function(str,obj){};

/* 重写 图片插件的放大方法 */
kefu.extend.image.fullScreen = function(imagesUrl){
	window.open(imagesUrl);
}
kefu.notification.use = false;
//kefu.js 初始化
kefu.init();
//出现列表页
kefu.ui.list.entry();


/***** 爱送达专用 *****/
//kefu.getMyUser();	//获取我的信息
var urlOtherToken = getUrlParams('otherToken');
if(urlOtherToken == null || urlOtherToken.length < 1){
	console.log('未传入otherToken');
	//alert('未传入otherToken');
}
kefu.getMyUser = function(){
	if(kefu.api.getMyUser == null || kefu.api.getMyUser.length < 1){
		msg.popups('请设置 kefu.api.getMyUser 接口，用于获取当前用户(我)的信息');
		return;
	}
	request.post(kefu.api.getMyUser,{token:kefu.token.get(), otherToken:urlOtherToken, }, function(data){
		if(data.result == '0'){
			msg.failure(data.info);
		}else{
			kefu.user = data.user;
			kefu.user.otherUserId = data.otherUserId;
			socket.connect(socketUrl);	//建立 socket 通讯
		}
	});
}
kefu.getMyUser();
/***** 爱送达专用结束 *****/

</script>

</body>
</html>